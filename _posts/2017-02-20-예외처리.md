---
layout: post
title: 예외처리
disqus: y
---


그동안 java를 다루면서 예외상황에서는 거의 throws로 던져주기만 하거나, printStacktrace() 함수를 이용해 예외 내용을 찍어주는 방법으로 예외처리를 해오고 있었다. 하지만, 코드리뷰나 토비의 스프링 책을 읽으며 예외상황에 대해 어떻게 처리를 해주어야할지에 대한 공부의 필요성을 느끼고 Exception 처리, 특히 웹 프로젝트에 대한 예외처리 공부를 해보기로 했다.
먼저 토비의 스프링에 나와있는 예외처리 방법을 공부한 뒤, Spring에서 제공하는 예외처리 방법에 대해 공부하고, 지금 진행하고 있는 모임 프로젝트에 실제로 공부한 내용의 예외처리를 적용할 것이다.

# 토비의 스프링 4장 - 예외

## 예외의 종류와 특징

### Exception

* 체크 예외 : 체크예외가 발생할 수 있는 메소드를 사용할 경우 반드시 예외를 처리하는 코드를 함께 작성해야한다.
    * ex) IOException, SQLException

## 예외처리 방법

### 예외복구

예외상황을 파악하고 문제를 해결해서 정상 상태로 돌려놓는 것.
예를 들면 네트워크가 불안해서 가끔 서버에 접속이 잘 안되는 열악한 환경에 있는 시스템이라면, 접속하다 실패할 경우 SQL Exception이 발생하는 경우에 재시도를 해볼 수 있다.

```
int maxretry = MAX_RETRY;
while(maxretry -- \> 0) {
    try{

     } catch (Exception e) {
        // 정해진 시간만큼 대기
     } finally {
        // 정리 작업
     }
}
throw new RetryFailedException(); // 최대 재시도 횟수를 넘기면 직접 예외 발생
```

### 예외처리 회피

예외처리를 자신이 담당하지 않고 자신을 호출한 쪽으로 던져버리는 것.
빈 catch 블록으로 잡아서 예외가 발생하지 않은 것처럼 만드는 경우는 특별한 의도를 가지고 있어야한다.

### 예외 전환

예외를 복구해서 정상적인 상태로는 만들 수 없기 때문에 예외를 메소드 밖으로 던지는 것. -\> 발생한 예외를 적절한 예외로 전환해서 던진다는 특징이 있음

* 내부에서 발생한 예외를 그대로 던지는 것이 그 예외 상황에 대한 적절한 의미를 부여해주지 못하는 경우 의미를 분명하게 해줄 수 있는 예외로 바꿔주기 위해
    * 중첩 예외 - 전환하는 예외에 원래 발생한 예외를 담아
* 예외를 처리하기 쉽고 단순하게 만들기 위해 포장
    * 주로 예외처리를 강제하는 체크 예외를 언체크 예외인 런타임 예외로 바꾸는 경우에 사용

## 예외처리 전략

### 런타임 예외의 보편화

예전에는 복구할 가능성이 조금이라도 있다면 체크예외로 만들었지만, 지금은 항상 복구할 수 있는 예외가 아니라면 일단 언체크 예외로 만드는 경향이 있다.

### 애플리케이션 예외

애플리케이션 자체의 로직에 의해 의도적으로 발생시키고, 반드시 catch해서 무엇인가 조치를 취하도록 요구하는 예외.

# Spring에서 Exception 처리

## ExceptionHandler

컨트롤러 내에 @ExceptionHandler 어노테이션을 적용한 메소드가 존재하면, 그 메서드가 Exception을 처리하도록 한다.

## ControllerAdvice

@ControllerAdvice는 하나의 컨트롤러가 아닌 여러 컨트롤러에서 하나의 Exception을 처리할 때 사용된다.




# Cogather에 존재하는 Exception Code

ToastCloude로 파일을 올리는 중 IOException이 발생할 경우, CloudAuthenticationException으로 중첩해서 새롭게 던져 주었다.
```
try { 
HttpEntity strAuth = new StringEntity(auth.toString());
request.setEntity(strAuth);
responseData = client.execute(request, new BasicResponseHandler());
} catch (IOException e) {
LOGGER.error("[toastAuthentication][인증 도중 에러가 발생하였습니다.]");
throw new CloudAuthenticationException("인증과정 중에 에러가 발생하였습니다.");
}
```
언체크 예외인 런타임 예외로 바꾸어서 마지막 참고할 페이지에서 처럼 jsp 공통 에러 페이지 처리를 통해 페이지에 오류가 발생했다는 사실을 사용자에게 알려주었다.

``` 
public class CloudAuthenticationException extends RuntimeException {
	public CloudAuthenticationException(Throwable cause){
		super(cause);
	}
	public CloudAuthenticationException(String msg){
		super(msg);
	}
	public CloudAuthenticationException(){
		super("CLOUD AUTHENTICATION ERROR");
	}
}

```


# 참고

**Spring에서 Exception 처리 ( @ExceptionHandler, @ControllerAdvice )**
http://blog.chakannom.com/2016/01/spring-exception-exceptionhandler.html

# 참고할 페이지

**jsp 공통 에러 페이지 처리(Servlet Exception Handling)**
http://jhgan.tistory.com/13
